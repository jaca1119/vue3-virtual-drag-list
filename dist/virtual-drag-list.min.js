!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("vue")):"function"==typeof define&&define.amd?define(["vue"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).VirtualDragList=e(t.Vue)}(this,function(j){"use strict";function B(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function N(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,P(i.key),i)}}function A(t,e,n){e&&N(t.prototype,e),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1})}function t(t,e,n){(e=P(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n}function L(t){return function(t){if(Array.isArray(t))return R(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){var n;if(t)return"string"==typeof t?R(t,e):"Map"===(n="Object"===(n=Object.prototype.toString.call(t).slice(8,-1))&&t.constructor?t.constructor.name:n)||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function P(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0===n)return("string"===e?String:Number)(t);if("object"!=typeof(n=n.call(t,e||"default")))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}var H,W,Y,u,X,K,U,q,s,l,a,o,c,r,V,h,d,f,p,m,G,g,v,Z,y,S,b,w,x,$,T,k,J;function Q(t){return(Q="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function O(){return(O=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n,i=arguments[e];for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function tt(t){if("undefined"!=typeof window&&window.navigator)return!!navigator.userAgent.match(t)}function et(t,e){t.style["".concat(q.css,"transition-duration")]=null==e?"":"".concat(e,"ms")}function nt(t,e){t.style["".concat(q.css,"transform")]=e?"".concat(e):""}function _(t,e,n){window.addEventListener?t.addEventListener(e,n,!(!U&&u)&&H):window.attachEvent?t.attachEvent("on"+e,n):t["on"+e]=n}function i(t,e,n){window.removeEventListener?t.removeEventListener(e,n,!(!U&&u)&&H):window.detachEvent?t.detachEvent("on"+e,n):t["on"+e]=null}function it(){return document.scrollingElement||document.documentElement}function E(t,e,n){if(t.getBoundingClientRect||t===window){var i,o,r,s,l,a,c=t!==window&&t.parentNode&&t!==it()?(o=(i=t.getBoundingClientRect()).top,r=i.left,s=i.bottom,l=i.right,a=i.height,i.width):(r=o=0,s=window.innerHeight,l=window.innerWidth,a=window.innerHeight,window.innerWidth);if(e&&t!==window){n=n||t.parentNode;do{if(n&&n.getBoundingClientRect){var u=n.getBoundingClientRect();o-=u.top+parseInt(I(n,"border-top-width")),r-=u.left+parseInt(I(n,"border-left-width")),s=o+i.height,l=r+i.width;break}}while(n=n.parentNode)}return{top:o,left:r,bottom:s,right:l,width:c,height:a}}}function ot(t,e,n,i){if(t){n=n||document;do{if(null==e){var o=Array.prototype.slice.call(n.children),r=o.indexOf(t);if(-1<r)return o[r];for(var s=0;s<o.length;s++)if(rt(t,o[s]))return o[s]}else if((">"!==e[0]||t.parentNode===n)&&at(t,e)||i&&t===n)return t}while(t=t.parentNode)}return null}function rt(t,e){if(t&&e){if(e.compareDocumentPosition)return e===t||16&e.compareDocumentPosition(t);if(e.contains&&1===t.nodeType)return e.contains(t)&&e!==t;for(;t=t.parentNode;)if(t===e)return 1}}function z(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)"TEMPLATE"===t.nodeName.toUpperCase()||e&&!at(t,e)||"none"===I(t,"display")||n++;return n}function st(t,e,n,i){for(var o=0,r=0,s=t.children;o<s.length;){if(s[o]!==M.ghost&&"none"!==I(s[o],"display")&&ot(s[o],n,t,!1)&&(i||s[o]!==M.dragged)){if(r===e)return s[o];r++}o++}return null}function lt(t,e){var n,i=I(t),o=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),r=st(t,0,e),t=st(t,1,e),e=r&&I(r),s=t&&I(t),l=e&&parseInt(e.marginLeft)+parseInt(e.marginRight)+E(r).width,a=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+E(t).width,c=X||u?"cssFloat":"float";return"flex"===i.display?"column"===i.flexDirection||"column-reverse"===i.flexDirection?"vertical":"horizontal":"grid"===i.display?i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal":r&&e.float&&"none"!==e.float?(n="left"===e.float?"left":"right",!t||"both"!==s.clear&&s.clear!==n?"horizontal":"vertical"):r&&("block"===e.display||"flex"===e.display||"table"===e.display||"grid"===e.display||o<=l&&"none"===i[c]||t&&"none"===i[c]&&o<l+a)?"vertical":"horizontal"}function C(t,e,n){var i;t&&e&&(t.classList?t.classList[n?"add":"remove"](e):(i=(" "+t.className+" ").replace(W," ").replace(" "+e+" "," "),t.className=(i+(n?" "+e:"")).replace(W," ")))}function at(t,e){if(e&&(">"===e[0]&&(e=e.substring(1)),t))try{return t.matches?t.matches(e):t.msMatchesSelector?t.msMatchesSelector(e):t.webkitMatchesSelector&&t.webkitMatchesSelector(e)}catch(t){}}function I(t,e,n){var i=t&&t.style;if(i){if(void 0===n)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),void 0===e?n:n[e];i[e=e in i||-1!==e.indexOf("webkit")?e:"-webkit-"+e]=n+("string"==typeof n?"":"px")}}function ct(t,e){return 2===(t=t.compareDocumentPosition?t.compareDocumentPosition(e):t.contains?(t!=e&&t.contains(e)&&16)+(t!=e&&e.contains(t)&&8)+(0<=t.sourceIndex&&0<=e.sourceIndex?(t.sourceIndex<e.sourceIndex&&4)+(t.sourceIndex>e.sourceIndex&&2):1)+0:0)?1:4===t?-1:0}function ut(t){void 0!==t.preventDefault&&t.cancelable&&t.preventDefault()}function D(t){var e=t.sortable,n=t.name,t=t.params;"function"==typeof(e=e.options[n])&&e(O({},t))}function ht(t){this.options=t,this.autoScrollAnimationFrame=null}function dt(t){this.options=t,this.animations=[]}function ft(t){this.options=t||{},this.selectedElements=[]}function M(t,e){if(!t||!t.nodeType||1!==t.nodeType)throw"Sortable-dnd: `el` must be an HTMLElement, not ".concat({}.toString.call(t));(t[a]=this).el=t,this.options=e=O({},e);var n,i,o={store:null,disabled:!1,group:"",animation:150,draggable:null,handle:null,multiple:!1,selectHandle:null,customGhost:null,direction:function(){return lt(t,e.draggable)},autoScroll:!0,scrollThreshold:55,scrollSpeed:{x:10,y:10},delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,ghostClass:"",ghostStyle:{},chosenClass:"",selectedClass:"",swapOnDrop:!0,fallbackOnBody:!1,supportTouch:"ontouchstart"in window,emptyInsertThreshold:-5};for(n in o)n in this.options||(this.options[n]=o[n]);for(i in J(e),this)"_"===i.charAt(0)&&"function"==typeof this[i]&&(this[i]=this[i].bind(this));var r=this.options.supportTouch;_(t,r?"touchstart":"mousedown",this._onDrag),k.push(t),this.autoScroller=new ht(this.options),this.multiplayer=new ft(this.options),this.animator=new dt(this.options)}H={capture:!1,passive:!1},W=/\s+/g,u=tt(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),X=tt(/Edge/i),K=tt(/safari/i)&&!tt(/chrome/i)&&!tt(/android/i),Y=!1,document.addEventListener("checkIfSupportPassive",null,{get passive(){return Y=!0}}),U=Y,q="undefined"==typeof window||"undefined"==typeof document?{}:(e=window.getComputedStyle(document.documentElement,"")||["-moz-hidden-iframe"],e=(Array.prototype.slice.call(e).join("").match(/-(moz|webkit|ms)-/)||""===e.OLink&&["","o"])[1],{dom:"WebKit|Moz|MS|O".match(new RegExp("("+e+")","i"))[1],lowercase:e,css:"-"+e+"-",js:e[0].toUpperCase()+e.substr(1)}),a="Sortable"+Date.now(),window.requestAnimationFrame||(window.requestAnimationFrame=function(t){return setTimeout(t,17)}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),ht.prototype={destroy:function(){null!=this.autoScrollAnimationFrame&&(cancelAnimationFrame(this.autoScrollAnimationFrame),this.autoScrollAnimationFrame=null)},update:function(t,e,n){var i=this;cancelAnimationFrame(this.autoScrollAnimationFrame),this.autoScrollAnimationFrame=requestAnimationFrame(function(){e&&n&&i.autoScroll(t,n),i.update(t,e,n)})},autoScroll:function(t,e){var n,i,o,r,s,l,a,c,u,h,d,f,p;t&&void 0!==e.clientX&&void 0!==e.clientY&&(h=E(t))&&(n=e.clientX,e=e.clientY,i=h.top,o=h.right,r=h.bottom,s=h.left,f=h.height,h=h.width,e<i||o<n||r<e||n<s||(l=(a=this.options).scrollThreshold,a=a.scrollSpeed,d=t.scrollTop,c=t.scrollLeft,p=t.scrollHeight,u=0<d&&i<=e&&e<=i+l,h=c+h<t.scrollWidth&&n<=o&&o-l<=n,d=d+f<p&&e<=r&&r-l<=e,(p=f=0)<c&&s<=n&&n<=s+l&&(f=Math.floor(Math.max(-1,(n-s)/l-1)*a.x)),h&&(f=Math.ceil(Math.min(1,(n-o)/l+1)*a.x)),u&&(p=Math.floor(Math.max(-1,(e-i)/l-1)*a.y)),(p=d?Math.ceil(Math.min(1,(e-r)/l+1)*a.y):p)&&(t.scrollTop+=p),f&&(t.scrollLeft+=f)))}},dt.prototype={collect:function(t){if(t){for(var e=E(t),n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,o=Math.min(e.right,n),r=Math.min(e.bottom,i),s=Array.prototype.slice.call(t.children),l=[],a=0;a<=s.length;a++){var c=s[a];if(c&&c!==M.ghost&&"none"!==I(c,"display")){var u=E(c);if(!(u.bottom<0||u.right<0)){if(u.top-u.height>r||u.left-u.width>o)break;l.push({node:c,rect:u})}}}this.animations.push(l)}},animate:function(){for(var t=this.animations.pop(),e=0,n=t.length;e<n;e++){var i=(o=t[e]).node,o=o.rect;this._excute(i,o)}},_excute:function(t,e){var n=e.left,e=e.top,i=E(t);i.top===e&&i.left===n||(e-=i.top,n-=i.left,et(t),nt(t,"translate3d(".concat(n,"px, ").concat(e,"px, 0)")),t.offsetWidth,et(t,this.options.animation),nt(t,"translate3d(0px, 0px, 0px)"),clearTimeout(t.animated),t.animated=setTimeout(function(){et(t),nt(t,""),t.animated=null},this.options.animation))}},ft.prototype={destroy:function(){s=l=null},active:function(){return!!s},setParams:function(t){t.nodes=s||[],t.clones=l||[]},select:function(t){C(t,this.options.selectedClass,!0),this.selectedElements.push(t),this.selectedElements.sort(ct)},deselect:function(t){var e=this.selectedElements.indexOf(t);-1<e&&(C(t,this.options.selectedClass,!1),this.selectedElements.splice(e,1))},getGhostElement:function(){var n;return s?(n=document.createElement("div"),this.selectedElements.forEach(function(t,e){(t=t.cloneNode(!0)).style="position: absolute;left: 0;top: 0;bottom: 0;right: 0;opacity: ".concat(0===e?1:.5,";z-index: ").concat(e,";"),n.appendChild(t)}),n):null},toggleSelected:function(e,t){var n=this;t?e.forEach(function(t){return n.selectedElements.push(t)}):this.selectedElements=this.selectedElements.filter(function(t){return e.indexOf(t)<0})},toggleClass:function(t){if(s)for(var e=0;e<s.length;e++)C(s[e],this.options.chosenClass,t)},toggleVisible:function(t){s&&(t?(t=s.indexOf(M.dragged),this._viewElements(s,t,M.dragged)):this._hideElements(s))},onChoose:function(){!this.options.multiple||!this.selectedElements.length||this.selectedElements.indexOf(M.dragged)<0||(this.selectedElements.sort(ct),s=this.selectedElements,this.toggleClass(!0))},onDrag:function(t){s&&(t.animator.collect(M.dragged.parentNode),this._hideElements(s),t.animator.animate(),this.toggleClass(!1))},onDrop:function(t,e,n){var i,o,r;s&&(o=M.clone,r=s.indexOf(i=M.dragged),e[a].animator.collect(o.parentNode),t!==e&&"clone"===n?(I(o,"display","none"),l=s.map(function(t){return t.cloneNode(!0)}),this._viewElements(l,r,o),this._viewElements(s,r,i)):this._viewElements(s,r,o),e[a].animator.animate(),t!==e)&&(e[a].multiplayer.toggleSelected(l||s,!0),"clone"!==n)&&t[a].multiplayer.toggleSelected(s,!1)},onSelect:function(t,e,n){var i=this.selectedElements.indexOf(e),t=(C(e,this.options.selectedClass,i<0),{from:n.el,event:t,node:e,index:z(e)});i<0?(this.selectedElements.push(e),D({sortable:n,name:"onSelect",params:t})):(this.selectedElements.splice(i,1),D({sortable:n,name:"onDeselect",params:t})),this.selectedElements.sort(ct)},_viewElements:function(t,e,n){for(var i,o=0;o<t.length;o++)I(t[o],"display",""),o<e?n.parentNode.insertBefore(t[o],n):(i=0<o?t[o-1]:n,n.parentNode.insertBefore(t[o],i.nextSibling))},_hideElements:function(t){for(var e=0;e<t.length;e++)t[e]!=M.dragged&&I(t[e],"display","none")}},k=[],J=function(t){var e={},n=t.group;n&&"object"==Q(n)||(n={name:n,pull:!0,put:!0,revertDrag:!0}),e.name=n.name,e.pull=n.pull,e.put=n.put,e.revertDrag=n.revertDrag,t.group=e},M.prototype={constructor:M,_onDrag:function(t){var e,n,i,o,r=this;c||this.options.disabled||!this.options.group.pull||/mousedown|pointerdown/.test(t.type)&&0!==t.button||(i=((e=t.touches&&t.touches[0])||t).target,K&&i&&"SELECT"===i.tagName.toUpperCase())||!(n=ot(i,this.options.draggable,this.el))||n.animated||(p={original:t,clientX:(e||t).clientX,clientY:(e||t).clientY},c=n,_(g=e?c:document,"mouseup",this._onDrop),_(g,"touchend",this._onDrop),_(g,"touchcancel",this._onDrop),o=(n=this.options).handle,"function"==typeof(n=n.selectHandle)&&n(t))||"string"==typeof n&&at(i,n)||"function"==typeof o&&!o(t)||"string"==typeof o&&!at(i,o)||(i=(n=this.options).delay,o=n.delayOnTouchOnly,!i||o&&!e||X||u?this._onStart(e,t):(_(this.el.ownerDocument,"touchmove",this._delayMoveHandler),_(this.el.ownerDocument,"mousemove",this._delayMoveHandler),_(this.el.ownerDocument,"mouseup",this._cancelStart),_(this.el.ownerDocument,"touchend",this._cancelStart),_(this.el.ownerDocument,"touchcancel",this._cancelStart),Z=setTimeout(function(){return r._onStart(e,t)},i)))},_delayMoveHandler:function(t){t=t.touches?t.touches[0]:t,Math.max(Math.abs(t.clientX-p.clientX),Math.abs(t.clientY-p.clientY))>=Math.floor(this.options.touchStartThreshold/(window.devicePixelRatio||1))&&this._cancelStart()},_cancelStart:function(){clearTimeout(Z),i(this.el.ownerDocument,"touchmove",this._delayMoveHandler),i(this.el.ownerDocument,"mousemove",this._delayMoveHandler),i(this.el.ownerDocument,"mouseup",this._cancelStart),i(this.el.ownerDocument,"touchend",this._cancelStart),i(this.el.ownerDocument,"touchcancel",this._cancelStart)},_onStart:function(t,e){var n=z(c);y=this.el,S=this.el,$=x=w=n,T=c,o=this.el,h=c.cloneNode(!0),f=c.parentNode,b=this.options.group.pull,M.clone=h,M.active=this,C(M.dragged=c,this.options.chosenClass,!0),this.multiplayer.onChoose(),D({sortable:this,name:"onChoose",params:this._getParams(e)}),_(g,t?"touchmove":"mousemove",this._nearestSortable);try{document.selection?setTimeout(function(){return document.selection.empty()},0):window.getSelection().removeAllRanges()}catch(t){}},_onStarted:function(){C(h,this.options.chosenClass,!0),this._appendGhost(),this.multiplayer.onDrag(this),D({sortable:this,name:"onDrag",params:this._getParams(p.original)}),I(c,"display","none"),C(c,this.options.chosenClass,!1),c.parentNode.insertBefore(h,c),K&&I(document.body,"user-select","none")},_getGhostElement:function(){var t=this.options.customGhost;return"function"==typeof t?t((t=this.multiplayer.selectedElements).length?t:[c]):this.multiplayer.getGhostElement()||c},_appendGhost:function(){if(!d){var t,e=(i=this.options).fallbackOnBody,n=i.ghostClass,i=i.ghostStyle,e=e?document.body:this.el,o=this._getGhostElement();C(d=o.cloneNode(!0),n,!0);var r=O({position:"fixed",top:(o=E(c)).top,left:o.left,width:o.width,height:o.height,minWidth:o.width,minHeight:o.height,opacity:"0.8",overflow:"hidden","z-index":"100000","box-sizing":"border-box","pointer-events":"none"},i);for(t in r)I(d,t,r[t]);d.style["".concat(q.css,"transition")]="none",nt(d,"translate3d(0px, 0px, 0px)"),M.ghost=d,e.appendChild(d),i=(p.clientX-o.left)/parseInt(d.style.width)*100,n=(p.clientY-o.top)/parseInt(d.style.height)*100,I(d,"transform-origin","".concat(i,"% ").concat(n,"%")),I(d,"transform","translateZ(0)"),I(d,"will-change","transform")}},_nearestSortable:function(t){ut(t);var e,n,o,r,s,i=t.touches&&t.touches[0],l=i||t;!p||!c||(n=m||p,void 0!==(e=l).clientX&&void 0!==e.clientY&&Math.abs(e.clientX-n.clientX)<=0&&Math.abs(e.clientY-n.clientY)<=0)||(m||this._onStarted(),m={original:t,clientX:l.clientX,clientY:l.clientY},e=i?document.elementFromPoint(l.clientX,l.clientY):l.target,n=l.clientX-p.clientX,i=l.clientY-p.clientY,nt(d,"translate3d(".concat(n,"px, ").concat(i,"px, 0)")),this.options.autoScroll&&(n=function(t){if(t&&t.getBoundingClientRect){var e=t;do{if(e.clientWidth<e.scrollWidth||e.clientHeight<e.scrollHeight){var n=I(e);if(e.clientWidth<e.scrollWidth&&("auto"==n.overflowX||"scroll"==n.overflowX)||e.clientHeight<e.scrollHeight&&("auto"==n.overflowY||"scroll"==n.overflowY))return e.getBoundingClientRect&&e!==document.body?e:it()}}while(e=e.parentNode)}return it()}(e),this.autoScroller.update(n,p,m)),o=l.clientX,r=l.clientY,k.some(function(t){var e,n,i=t[a].options.emptyInsertThreshold;if(null!=i)return n=E(t),e=o>=n.left-i&&o<=n.right+i,n=r>=n.top-i&&r<=n.bottom+i,e&&n?s=t:void 0}),s&&s[a]._onMove(t,e))},_allowPut:function(){var t,e,n;return o===this.el||!!this.options.group.put&&(t=(e=this.options.group).name,e=e.put,n=o[a].options.group,e.join&&-1<e.indexOf(n.name)||n.name&&t&&n.name===t)},_allowSwap:function(){var t=ct(h,r),e=(V=t<0?r.nextSibling:r,E(r)),n="vertical"===(o="function"==typeof this.options.direction?this.options.direction.call(m.original,c,this):this.options.direction),i=n?m.clientY:m.clientX,o=r["vertical"===o?"offsetHeight":"offsetWidth"],i=i>=(n?e.top:e.left)&&i<(n?e.bottom:e.right)-o/2?-1:1;return G!==r?(v=i,!0):v!==i&&((v=i)<0?0<t:t<0)},_onMove:function(t,e){var n,i;this._allowPut()&&(D({sortable:this,name:"onMove",params:this._getParams(t)}),this.el===S||e!==this.el&&function(t){for(var e=t.lastElementChild;e&&(e===M.ghost||"none"===I(e,"display"));)e=e.previousElementSibling;return e}(this.el)?(r=ot(e,this.options.draggable,this.el))&&!r.animated&&this._allowSwap()&&(r===h||rt(r,h)||(this.el!==S?this._onInsert(t):(n=t,i=i||E(f),n.clientX<=i.right&&n.clientX>=i.left&&n.clientY>=i.top&&n.clientY<=i.bottom&&e===f||this._onChange(t))),G=r):(r=G=null,this._onInsert(t)))},_onInsert:function(t){var e=r||h,n="clone"===b&&this.el!==o&&S===o,i="clone"===b&&this.el===o&&S!==o;y=this.el,w=z(h),T=e,f=r?r.parentNode:this.el,S[a].animator.collect(h.parentNode),this.animator.collect(f),n&&(I(c,"display",""),o[a].multiplayer.toggleVisible(!0),o[a].options.group.revertDrag||S.insertBefore(c,h)),i&&(w=z(c),I(c,"display","none"),this.multiplayer.toggleVisible(!1)),r?f.insertBefore(h,v<0?r:r.nextSibling):f.appendChild(h),x=z(h),n&&o[a].options.group.revertDrag&&D({sortable:o[a],name:"onChange",params:this._getParams(t,{to:o,target:c,newIndex:$,revertDrag:!0})}),n||D({sortable:S[a],name:"onRemove",params:this._getParams(t)}),i&&r!==c&&D({sortable:this,name:"onChange",params:this._getParams(t,{from:o,backToOrigin:!0})}),i||D({sortable:this,name:"onAdd",params:this._getParams(t)}),S[a].animator.animate(),this.animator.animate(),S=this.el},_onChange:function(t){r!==c&&(f=r.parentNode,w=z(h),T=r,this.animator.collect(f),f.insertBefore(h,V),x=z(h),D({sortable:this,name:"onChange",params:this._getParams(t)}),this.animator.animate(),S=this.el)},_onDrop:function(t){var e,n;ut(t),this._cancelStart(),i(g,"touchmove",this._nearestSortable),i(g,"mousemove",this._nearestSortable),i(g,"mouseup",this._onDrop),i(g,"touchend",this._onDrop),i(g,"touchcancel",this._onDrop),C(c,this.options.chosenClass,!1),o&&(S=o,w=$,T===h&&(T=c),this.multiplayer.toggleClass(!1),D({sortable:this,name:"onUnchoose",params:this._getParams(t)}),m)&&this._onEnd(t),o||m||!this.options.multiple||(n=(e=t.changedTouches?t.changedTouches[0]:t).clientX-p.clientX,e=e.clientY-p.clientY,0<=(n=Math.sqrt(n*n+e*e))&&n<=1&&this.multiplayer.onSelect(t,c,this)),d&&d.parentNode&&d.parentNode.removeChild(d),this.multiplayer.destroy(),this.autoScroller.destroy(),this._nulling()},_onEnd:function(t){var t=this._getParams(t),e=(this.multiplayer.onDrop(S,y,b),this.options.swapOnDrop);("clone"!==b||S===y)&&("function"==typeof e?e(t):e)&&f.insertBefore(c,h),"clone"!==b||S===y||this.multiplayer.active()?h&&h.parentNode&&h.parentNode.removeChild(h):C(h,this.options.chosenClass,!1),I(c,"display",""),K&&I(document.body,"user-select",""),S!==y&&D({sortable:S[a],name:"onDrop",params:t}),D({sortable:y[a],name:"onDrop",params:t})},_getParams:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n={};return n.event=t,n.to=y,n.from=S,n.node=c,n.clone=h,n.target=T,n.oldIndex=w,n.newIndex=x,n.pullMode=b,this.multiplayer.setParams(n),O(n,e),n.relative=n.target===c?0:ct(n.target,h),n},_nulling:function(){y=S=o=c=r=V=h=d=f=b=w=x=$=p=m=T=G=g=v=Z=M.clone=M.ghost=M.active=M.dragged=null},destroy:function(){this._nulling(),this._cancelStart(),i(this.el,"touchstart",this._onDrag),i(this.el,"mousedown",this._onDrag),k.splice(k.indexOf(this.el),1),this.el[a]=this.animator=this.multiplayer=this.autoScroller=null},option:function(t,e){if(void 0===e)return this.options[t];this.options[t]=e,this.animator.options[t]=e,this.multiplayer.options[t]=e,this.autoScroller.options[t]=e,"group"===t&&J(this.options)},select:function(t){this.multiplayer.select(t)},deselect:function(t){this.multiplayer.deselect(t)},getSelectedElements:function(){return this.multiplayer.selectedElements}},M.utils={on:_,off:i,css:I,index:z,closest:ot,getRect:E,toggleClass:C,detectDirection:lt},M.get=function(t){return t[a]},M.create=function(t,e){return new M(t,e)};var F=M;function pt(r,t,e){function n(){for(var t,e=this,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return s&&clearTimeout(s),c?(t=!s,s=setTimeout(function(){s=null},a),t&&(l=r.apply(this,i))):s=setTimeout(function(){r.apply(e,i)},a),l}var s,l,a=1<arguments.length&&void 0!==t?t:50,c=2<arguments.length&&void 0!==e&&e;return n.prototype.cancel=function(){clearTimeout(s),s=null},n}function mt(i,t){var o,r=1<arguments.length&&void 0!==t?t:50;return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];o=o||setTimeout(function(){o=null,i.apply(this,e)},r)}}function gt(t,e){return(Array.isArray(e)?e:e.replace(/\[/g,".").replace(/\]/g,".").split(".")).reduce(function(t,e){return(t||{})[e]},t)}function vt(n,i,o){function t(){var t=n.event,e=n.dataKey;o(t,i.value?i.value[r.value]:0,e)}var e=null,r=j.computed(function(){return n.isHorizontal?"offsetWidth":"offsetHeight"});j.onMounted(function(){"undefined"!=typeof ResizeObserver&&(e=new ResizeObserver(function(){t()}),i.value)&&e.observe(i.value)}),j.onUpdated(function(){t()}),j.onUnmounted(function(){e&&(e.disconnect(),e=null)})}var yt=["group","delay","handle","disabled","draggable","animation","autoScroll","ghostClass","ghostStyle","chosenClass","fallbackOnBody","scrollThreshold","delayOnTouchOnly"],St=function(){function o(t,e,n){var i=this,e=(B(this,o),this.ctx=t,this.onDrag=e,this.onDrop=n,this.list=L(t.list),this.store={},this.reRendered=!1,yt.reduce(function(t,e){return t[e]=i.ctx[e],t},{}));this.sortable=new F(this.ctx.container,Object.assign(Object.assign({},e),{swapOnDrop:function(t){return t.from===t.to},onDrag:function(t){return i._onDrag(t)},onAdd:function(t){return i._onAdd(t)},onRemove:function(t){return i._onRemove(t)},onChange:function(t){return i._onChange(t)},onDrop:function(t){return i._onDrop(t)}}))}return A(o,[{key:"destroy",value:function(){this.sortable&&this.sortable.destroy(),this.sortable=null}},{key:"setValue",value:function(t,e){"list"===t?this.list=L(e):this.sortable&&this.sortable.option(t,e)}},{key:"_onDrag",value:function(t){var e,t=t.node.dataset.key,n=this._getIndex(this.list,t),i=this.list[n];this.store={item:i,key:t,origin:{index:n,list:this.list},from:{index:n,list:this.list},to:{index:n,list:this.list}},null!=(e=this.sortable)&&e.option("store",this.store),this.onDrag(),this.ctx.emit("drag",{item:i,key:t,index:n})}},{key:"_onRemove",value:function(t){var e,t=t.node.dataset.key,n=this._getIndex(this.list,t),i=this.list[n];this.list.splice(n,1),Object.assign(this.store,{key:t,item:i}),null!=(e=this.sortable)&&e.option("store",this.store),this.ctx.emit("remove",{item:i,index:n,key:t})}},{key:"_onAdd",value:function(t){var e=t.from,n=t.target,t=t.relative,e=null==(e=F.get(e))?void 0:e.option("store"),i=e.key,e=e.item,n=this._getIndex(this.list,n.dataset.key);-1===t&&(n+=1),this.list.splice(n,0,e),Object.assign(this.store,{to:{index:n,list:this.list}}),null!=(t=this.sortable)&&t.option("store",this.store),this.ctx.emit("add",{item:e,index:n,key:i})}},{key:"_onChange",value:function(t){var e,n,i,o,r=null==(r=F.get(t.from))?void 0:r.option("store");t.revertDrag?(this.list=L(this.ctx.list),Object.assign(this.store,{from:r.origin})):(n=t.node,o=t.target,e=t.relative,t=t.backToOrigin,n=this._getIndex(this.list,n.dataset.key),i=this.list[n],o=this._getIndex(this.list,o.dataset.key),t&&(1===e&&r.from.index<o&&--o,-1===e)&&r.from.index>o&&(o+=1),this.list.splice(n,1),this.list.splice(o,0,i),Object.assign(this.store,{from:{index:o,list:this.list},to:{index:o,list:this.list}}))}},{key:"_onDrop",value:function(t){var e=this._getStore(t),n=e.from,e=e.to,i=t.from!==t.to||n.origin.index!==e.to.index;this.onDrop({list:this.list}),this.ctx.emit("drop",{changed:i,list:this.list,item:n.item,key:n.key,from:n.origin,to:e.to}),this.ctx.container===t.from&&this.reRendered&&null!=(i=F.dragged)&&i.remove(),t.from!==t.to&&"clone"===t.pullMode&&null!=(n=F.clone)&&n.remove(),this.reRendered=!1}},{key:"_getIndex",value:function(t,e){for(var n=0;n<t.length;n++)if(gt(t[n],this.ctx.dataKey)==e)return n;return-1}},{key:"_getStore",value:function(t){var e;return{from:null==(e=F.get(t.from))?void 0:e.option("store"),to:null==(e=F.get(t.to))?void 0:e.option("store")}}}]),o}(),bt="INIT",wt="FIXED",xt="DYNAMIC",Tt="FRONT",kt="BEHIND",Ot="STATIONARY",e="horizontal",_t="vertical",Et=(t(n={},_t,"scrollTop"),t(n,e,"scrollLeft"),n),zt=(t(n={},_t,"scrollHeight"),t(n,e,"scrollWidth"),n),Ct=(t(n={},_t,"offsetHeight"),t(n,e,"offsetWidth"),n),It=(t(n={},_t,"offsetTop"),t(n,e,"offsetLeft"),n),Dt=["size","keeps","scroller","direction","debounceTime","throttleTime"],Mt=function(){function e(t){B(this,e),this.options=t,this.sizes=new Map,this.range=Object.create(null),this.offset=0,this.calcType=bt,this.calcSize=Object.create(null),this.direction="",this.useWindowScroll=!1,this.onScroll=null,this.updateScrollElement(),this.updateOnScrollFunction(),this.addScrollEventListener(),this.checkIfUpdate(0,t.keeps-1)}return A(e,[{key:"isFront",value:function(){return this.direction===Tt}},{key:"isBehind",value:function(){return this.direction===kt}},{key:"isFixed",value:function(){return this.calcType===wt}},{key:"getSize",value:function(t){return this.sizes.get(t)||this.getItemSize()}},{key:"getOffset",value:function(){return this.scrollEl[Et[this.options.direction]]}},{key:"getScrollSize",value:function(){return this.scrollEl[zt[this.options.direction]]}},{key:"getClientSize",value:function(){return this.scrollEl[Ct[this.options.direction]]}},{key:"scrollToOffset",value:function(t){this.scrollEl[Et[this.options.direction]]=t}},{key:"scrollToIndex",value:function(t){t>=this.options.uniqueKeys.length-1?this.scrollToBottom():(t=this.getOffsetByIndex(t),this.scrollToOffset(t))}},{key:"scrollToBottom",value:function(){var n=this,t=this.getScrollSize();this.scrollToOffset(t),setTimeout(function(){var t=n.getClientSize(),e=n.getScrollSize();n.getOffset()+t+1<e&&n.scrollToBottom()},5)}},{key:"updateOptions",value:function(t,n){var i=this,e=this.options[t];this.options[t]=n,"uniqueKeys"===t?this.sizes.forEach(function(t,e){n.includes(e)||i.sizes.delete(e)}):"scroller"===t&&(null!=e&&e.removeEventListener("scroll",this.onScroll),this.updateScrollElement(),this.addScrollEventListener())}},{key:"updateRange",value:function(t){t?this.handleUpdate(t.start,t.end):(t=this.range.start,t=Math.max(t,0),this.handleUpdate(t,this.getEndByStart(t)))}},{key:"handleItemSizeChange",value:function(t,e){this.sizes.set(t,e),this.calcType===bt?(this.calcType=wt,this.calcSize.fixed=e):this.isFixed()&&this.calcSize.fixed!==e&&(this.calcType=xt,this.calcSize.fixed=0),this.calcType!==wt&&(this.calcSize.total=L(this.sizes.values()).reduce(function(t,e){return t+e},0),this.calcSize.average=Math.round(this.calcSize.total/this.sizes.size))}},{key:"handleSlotSizeChange",value:function(t,e){this.calcSize[t]=e}},{key:"addScrollEventListener",value:function(){var t;null!=(t=this.options.scroller)&&t.addEventListener("scroll",this.onScroll,!1)}},{key:"removeScrollEventListener",value:function(){var t;null!=(t=this.options.scroller)&&t.removeEventListener("scroll",this.onScroll)}},{key:"updateOnScrollFunction",value:function(){var t=this,e=this.options,n=e.debounceTime,e=e.throttleTime;this.onScroll=n?pt(function(){return t.handleScroll()},n):e?mt(function(){return t.handleScroll()},e):function(){return t.handleScroll()}}},{key:"updateScrollElement",value:function(){this.scrollEl=this.getScrollElement(this.options.scroller)}},{key:"handleScroll",value:function(){var t,e,n,i;0!==this.sizes.size&&(t=this.getOffset(),e=this.getClientSize(),i=this.getScrollSize(),t===this.offset?this.direction=Ot:this.direction=t<this.offset?Tt:kt,this.offset=t,n=this.isFront()&&t<=0,i=this.isBehind()&&i<=e+t,this.options.onScroll({top:n,bottom:i,offset:t,direction:this.direction}),this.isFront()?this.handleScrollFront():this.isBehind()&&this.handleScrollBehind())}},{key:"handleScrollFront",value:function(){var t=this.getScrollItems();t>this.range.start||(t=Math.max(t-this.options.buffer,0),this.checkIfUpdate(t,this.getEndByStart(t)))}},{key:"handleScrollBehind",value:function(){var t=this.getScrollItems();t<this.range.start+this.options.buffer||this.checkIfUpdate(t,this.getEndByStart(t))}},{key:"getScrollItems",value:function(){var t=this.offset-this.getScrollStartOffset();if(t<=0)return 0;if(this.isFixed())return Math.floor(t/this.calcSize.fixed);for(var e,n,i=0,o=this.options.uniqueKeys.length;i<=o;){if(e=i+Math.floor((o-i)/2),(n=this.getOffsetByIndex(e))===t)return e;n<t?i=e+1:t<n&&(o=e-1)}return 0<i?--i:0}},{key:"checkIfUpdate",value:function(t,e){var n=this.options.keeps;this.options.uniqueKeys.length<=n?(t=0,e=this.getLastIndex()):e-t<n-1&&(t=e-n+1),this.range.start!==t&&this.handleUpdate(t,e)}},{key:"handleUpdate",value:function(t,e){this.range.start=t,this.range.end=e,this.range.front=this.getFrontOffset(),this.range.behind=this.getBehindOffset(),this.options.onUpdate(Object.assign({},this.range))}},{key:"getFrontOffset",value:function(){return this.isFixed()?this.calcSize.fixed*this.range.start:this.getOffsetByIndex(this.range.start)}},{key:"getBehindOffset",value:function(){var t=this.range.end,e=this.getLastIndex();return this.isFixed()?(e-t)*this.calcSize.fixed:(e-t)*this.getItemSize()}},{key:"getOffsetByIndex",value:function(t){if(!t)return 0;for(var e=0,n=0;n<t;n++){var i=this.sizes.get(this.options.uniqueKeys[n]);e+="number"==typeof i?i:this.getItemSize()}return e}},{key:"getEndByStart",value:function(t){return Math.min(t+this.options.keeps-1,this.getLastIndex())}},{key:"getLastIndex",value:function(){var t=this.options,e=t.uniqueKeys,t=t.keeps;return 0<e.length?e.length-1:t-1}},{key:"getItemSize",value:function(){return this.isFixed()?this.calcSize.fixed:this.calcSize.average||this.options.size}},{key:"getScrollStartOffset",value:function(){var t=this.calcSize.header||0;if(this.useWindowScroll&&this.options.wrapper)for(var e=this.options.wrapper;t+=e[It[this.options.direction]],(e=e.offsetParent)&&e!==this.options.wrapper.ownerDocument;);return t}},{key:"getScrollElement",value:function(t){return t instanceof Document&&9===t.nodeType||t instanceof Window?(this.useWindowScroll=!0,document.scrollingElement||document.documentElement||document.body):(this.useWindowScroll=!1,t)}}]),e}(),_t={dataSource:{default:[],required:!0},dataKey:{type:String,default:"",required:!0},draggable:{type:[String]},handle:{type:[Function,String]},group:{type:[Object,String]},scroller:{},direction:{type:String,default:"vertical"},keeps:{type:Number,default:30},size:{type:Number},debounceTime:{type:Number,default:0},throttleTime:{type:Number,default:0},animation:{type:Number,default:150},autoScroll:{type:Boolean,default:!0},scrollThreshold:{type:Number,default:55},keepOffset:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},fallbackOnBody:{type:Boolean,default:!1},delay:{type:Number,default:0},delayOnTouchOnly:{type:Boolean,default:!1},rootTag:{type:String,default:"div"},wrapTag:{type:String,default:"div"},headerTag:{type:String,default:"div"},footerTag:{type:String,default:"div"},itemTag:{type:String,default:"div"},wrapClass:{type:String,default:""},wrapStyle:{type:Object,default:function(){return{}}},itemStyle:{type:Object,default:function(){return{}}},itemClass:{type:String,default:""},ghostClass:{type:String,default:""},ghostStyle:{type:Object,default:function(){return{}}},chosenClass:{type:String,default:""},headerStyle:{type:Object,default:function(){return{}}},footerStyle:{type:Object,default:function(){return{}}}},n={tag:{type:String,default:"div"},event:{type:String},dataKey:{type:[String,Number]},isHorizontal:{type:Boolean}},Bt=j.defineComponent({name:"VirtualDraglistItems",props:n,emits:["resize"],setup:function(n,t){var e=t.emit,i=t.slots,o=j.ref(null);return vt(n,o,e),function(){var t=n.tag,e=n.dataKey;return j.h(t,{ref:o,key:e,"data-key":e},{default:function(){var t;return null==(t=i.default)?void 0:t.call(i)}})}}}),Nt=j.defineComponent({name:"VirtualDraglistSlots",props:n,emits:["resize"],setup:function(n,t){var e=t.emit,i=t.slots,o=j.ref(null);return vt(n,o,e),function(){var t=n.tag,e=n.dataKey;return j.h(t,{ref:o,key:e,"data-key":e},{default:function(){var t;return null==(t=i.default)?void 0:t.call(i)}})}}});return j.defineComponent({props:_t,emits:["update:dataSource","top","bottom","drag","drop","add","remove"],setup:function(c,t){var i,u,n=this,o=t.emit,r=t.slots,t=t.expose,h=j.ref(Object.create(null)),d=j.ref(null),f=j.ref(null),s=j.ref([]),e=j.ref([]),p=j.computed(function(){return"vertical"!==c.direction}),l=j.computed(function(){return Dt.reduce(function(t,e){return t[e]=c[e],t},{})}),a=j.computed(function(){return yt.reduce(function(t,e){return t[e]=n[e],t},{})}),m=null,g=null,v=0;function y(){return u.getOffset()}function S(){return u.getClientSize()}function b(){return u.getScrollSize()}function w(t){u.scrollToOffset(t)}function x(t){u.scrollToIndex(t)}t({getSize:function(t){return u.getSize(t)},getOffset:y,getClientSize:S,getScrollSize:b,scrollToTop:function(){w(0)},scrollToBottom:function(){u.scrollToBottom()},scrollToKey:function(t){-1<(t=e.value.indexOf(t))&&u.scrollToIndex(t)},scrollToIndex:x,scrollToOffset:w}),j.watch(function(){return c.dataSource},function(){O()},{deep:!0}),j.watch(function(){return l},function(t,e){if(u)for(var n in t)t[n]!=e[n]&&u.updateOptions(n,t[n])}),j.watch(function(){return a},function(t,e){if(u)for(var n in t)t[n]!=e[n]&&i.setValue(n,t[n])}),j.onBeforeMount(function(){E(),O()}),j.onActivated(function(){u&&w(u.offset),u.addScrollEventListener()}),j.onDeactivated(function(){u.removeScrollEventListener()}),j.onMounted(function(){u.updateOptions("wrapper",f.value),c.scroller||u.updateOptions("scroller",d.value)}),j.onUnmounted(function(){i&&i.destroy(),u.removeScrollEventListener()});function T(t,e){var n=r[t];return n?j.h(Nt,{key:t,tag:e,style:c["".concat(t,"Style")],dataKey:t,event:"resize",onResize:N},{default:function(){return null==n?void 0:n()}}):null}function k(){for(var o=[],t=h.value,e=t.start,n=t.end,i=e;i<=n;i++)!function(e){var n,t,i=s.value[e];i&&(n=gt(i,c.dataKey),t=Object.assign(Object.assign({},c.itemStyle),A(n)),o.push(r.item?j.h(Bt,{key:n,tag:c.itemTag,class:c.itemClass,style:t,event:"resize",dataKey:n,isHorizontal:p.value,onResize:B},{default:function(){var t;return null==(t=r.item)?void 0:t.call(r,{record:i,index:e,dataKey:n})}}):null))}(i);return o}var O=function(){e=c.dataSource;var t,e=j.isRef(e)?e.value:e;e&&(t=L(s.value),s.value=e,_(),u.sizes.size?C(t,e):(clearTimeout(g),g=setTimeout(function(){return u.updateRange()},17)),i?i.setValue("list",e):j.nextTick(function(){return z()}),m)&&c.keepOffset&&(0<(t=e.length-m)&&x(t),m=null)},_=function(){e.value=s.value.map(function(t){return gt(t,c.dataKey)}),u.updateOptions("uniqueKeys",e.value)},E=function(){u=new Mt({size:c.size,keeps:c.keeps,buffer:Math.round(c.keeps/3),scroller:c.scroller,direction:c.direction,uniqueKeys:e.value,debounceTime:c.debounceTime,throttleTime:c.throttleTime,onScroll:function(t){m=null,s.value.length&&t.top?D():t.bottom&&M()},onUpdate:function(t){F.dragged&&i&&t.start!==h.value.start&&(i.reRendered=!0),h.value=t}})},z=function(){i=new St(Object.assign({container:f.value,list:s.value,emit:o},c),function(){v=h.value.start},function(t){var e,t=t.list;t.length===s.value.length&&v<h.value.start&&(h.value.front+=(null==(e=F.clone)?void 0:e[p.value?"offsetWidth":"offsetHeight"])||0,v=h.value.start),o("update:dataSource",t)})},C=function(t,e){var n,i=Object.assign({},h.value);0<i.start&&-1<(n=e.indexOf(t[i.start]))&&(i.start=n,i.end=n+c.keeps-1),e.length>t.length&&i.end===t.length-1&&I()&&(i.end++,i.start=Math.max(0,i.end-c.keeps+1)),u.updateRange(i)},I=function(){var t=y(),e=S();return b()<=t+e+1},D=mt(function(){o("top"),m=s.value.length}),M=mt(function(){o("bottom")}),B=function(t,e){u.handleItemSizeChange(e,t)},N=function(t,e){u.handleSlotSizeChange(e,t)},A=function(t){return t==(null==(t=F.dragged)?void 0:t.dataset.key)?{display:"none"}:{}};return function(){var t=u.useWindowScroll,e=c.rootTag,n=c.wrapTag,i=c.wrapClass,o=c.headerTag,r=c.footerTag,s=h.value,l=s.front,s=s.behind,a=Object.assign(Object.assign({},c.wrapStyle),{padding:p.value?"0px ".concat(s,"px 0px ").concat(l,"px"):"".concat(l,"px 0px ").concat(s,"px")});return j.h(e,{ref:d,style:!t&&{overflow:p.value?"auto hidden":"hidden auto"}},{default:function(){return[T("header",o),j.h(n,{ref:f,class:i,style:a},{default:k}),T("footer",r)]}})}}})});
